<html>
	<head>
		<script>
		window.onload = function(){
		startGame();
		}
		function startGame() {
		init_array();
		random();
		createComponent ();
    //Hàm startGame() gọi đến method start() của đối tượng myGameArea
		myGameArea.start();
		
		
};
	var flag = 0;
	var core = 0;
	var arr = new Array(4);
		function init_array(){
			for(var i=0;i<4;i++)
				arr[i] = new Array(0,0,0,0);
		}
	var myGamePiece = new Array(16);
		function createComponent()
		{
			for(var x=0;x<4;x++)
				for(var y=0;y<4;y++)
				{	
					if (arr[x][y] == 0)
						component(64,64,"0.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 2)
						component(64,64,"2.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 4)
						component(64,64,"4.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 8)
						component(64,64,"8.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 16)
						component(64,64,"16.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 32)
						component(64,64,"32.png",x+x*64+2,y+y*64+2,"image");
				}
		}
	var myGameArea = {
   
		start : function() {
			var canvas = document.getElementById("mycanvas");

			// nội dung bên trong của vùng không gian này là các thứ được vẽ từ đối tượng getContext("2d")
			this.context = canvas.getContext("2d");		
			if(flag == 1)
				this.interval = setInterval(updateGame,5000);
		},
		clear : function(){
			this.context.clearRect(0,0,600,600);
			flag = 0;
		}
		
	}
	function random(){
		var x = Math.floor(Math.random()*4);
		var y = Math.floor(Math.random()*4);
		while(arr[x][y] !=0){
			var x = Math.floor(Math.random()*4);
			var y = Math.floor(Math.random()*4);
			}
		arr[x][y] = 2;
	}
	function component(width, height, src, x, y,type) {
		this.width = width;
		this.height = height;
		this.x = x;
		this.y = y;
		var img = new Image();
		img.onload = function(){
			ctx = myGameArea.context;
			ctx.drawImage(img,y,x);
		};
		img.src = src;	
	}
	function updateGame(){
		
		random();
		createComponent();
	}
	function moveleft(){
		for(var x = 0;x<4;x++)
				for(var y = 0;y<4;y++)
					for(var j = y+1;j<4;j++)
					{
						if((arr[x][y] == arr[x][j] || arr[x][y] == 0) && arr[x][j]!=0)
							{
								arr[x][y]+=arr[x][j];
								arr[x][j] = 0;
								core+=arr[x][y];
								break;
							}
					}
		random();
		createComponent();
	}
	function moveright(){
		for(var x = 0;x<4;x++)
			{
				for(var y = 3;y>=0;y--)
				{
					for(var j = y-1;j>=0;j--)
					{
						if((arr[x][y] == arr[x][j] || arr[x][y] == 0) && arr[x][j]!=0)
							{
								arr[x][y]+=arr[x][j];
								arr[x][j] = 0;
								core+=arr[x][y];
								break;
							}
					}
				}
			}
		random();
		createComponent();
	}
	function moveup(){
		for(var y = 0;y<4;y++)
				for(var x = 0;x<4;x++)
					for(var j = x+1;j<4;j++)
					{
						if((arr[x][y] == arr[j][y] || arr[x][y] == 0) && arr[j][y]!=0)
							{
								arr[x][y]+=arr[j][y];
								arr[j][y] = 0;
								core+=arr[x][y];
								break;
							}
					}
		random();
		createComponent();
	}
	function movedown(){
		for(var y = 0;y<4;y++)
				for(var x = 3;x>=0;x--)
					for(var j = x-1;j>=0;j--)
					{
						if((arr[x][y] == arr[j][y] || arr[x][y] == 0) && arr[j][y]!=0)
							{
								arr[x][y]+=arr[j][y];
								arr[j][y] = 0;
								core+=arr[x][y];
								break;
							}
					}
		random();
		createComponent();
	}
		</script>	
<button onclick="moveup()">UP</button>
<button onclick="movedown()">DOWN</button>
<button onclick="moveleft()">LEFT</button>
<button onclick="moveright()">RIGHT</button>
	<body><canvas id = "mycanvas" width = "600" height = "600"></canvas></body>
	</head></html>