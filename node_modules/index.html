<html>
	<head>
		<script>
		window.onload = function(){
		startGame();
		}
		function startGame() {
		init_array();
		random();
		createComponent ();
    //Hàm startGame() gọi đến method start() của đối tượng myGameArea
		myGameArea.start();
		
		
};
	var core = 0;
	var arr = new Array(4);
		function init_array(){
			for(var i=0;i<4;i++)
				arr[i] = new Array(0,0,0,0);
		}
	var myGamePiece = new Array(16);
		function createComponent()
		{
			for(var x=0;x<4;x++)
				for(var y=0;y<4;y++)
				{	
					if (arr[x][y] == 0)
						myGamePiece[x*4+y] = component(64,64,"0.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 2)
						myGamePiece[x*4+y] = component(64,64,"2.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 4)
						myGamePiece[x*4+y] = component(64,64,"4.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 8)
						myGamePiece[x*4+y] = component(64,64,"8.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 16)
						myGamePiece[x*4+y] = component(64,64,"16.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 32)
						myGamePiece[x*4+y] = component(64,64,"32.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 64)
						myGamePiece[x*4+y] = component(64,64,"64.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 128)
						myGamePiece[x*4+y] = component(64,64,"128.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 256)
						myGamePiece[x*4+y] = component(64,64,"256.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 512)
						myGamePiece[x*4+y] = component(64,64,"512.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 1024)
						myGamePiece[x*4+y] = component(64,64,"1024.png",x+x*64+2,y+y*64+2,"image");
					if (arr[x][y] == 2048)
						myGamePiece[x*4+y] = component(64,64,"2048.png",x+x*64+2,y+y*64+2,"image");
				}
		}
	var myGameArea = {
   
		start : function() {
			var canvas = document.getElementById("mycanvas");

			// nội dung bên trong của vùng không gian này là các thứ được vẽ từ đối tượng getContext("2d")
			this.context = canvas.getContext("2d");		
		},
	
		clear : function(){
			this.context.clearRect(0,0,600,600);
			flag = 0;
		}
		
	}
	function random(){
		var x = Math.floor(Math.random()*4);
		var y = Math.floor(Math.random()*4);
		while(arr[x][y] !=0){
			var x = Math.floor(Math.random()*4);
			var y = Math.floor(Math.random()*4);
			}
		arr[x][y] = 2;
	}
	function component(width, height, src, x, y,type) {
		this.width = width;
		this.height = height;
		this.x = x;
		this.y = y;
		if(type == "image"){
			var img = new Image();
			img.onload = function(){
				ctx = myGameArea.context;
				ctx.drawImage(img,y,x);
			};
			img.src = src;	
		}
	}
	function moveleft(){
		var flag = 0;
		for(var x = 0;x<4;x++)
				for(var y = 0;y<4;y++)
					for(var j = y+1;j<4;j++)
					{
						if((arr[x][y] == arr[x][j] || arr[x][y] == 0) && arr[x][j]!=0)
							{
								if(arr[x][y]!=0 && arr[x][y+1]!=0 && arr[x][y+1]!=arr[x][y])
									break;
								arr[x][y]+=arr[x][j];
								arr[x][j] = 0;
								core+=arr[x][y];
								flag = 1;
								if(arr[x][y]==arr[x][j])
									break;
							}
					}
		createComponent();			
		if (flag == 1){
			random();
		}
		flag = 0;
		createComponent();
	}
	function moveright(){
		var flag = 0;
		for(var x = 0;x<4;x++)
			{
				for(var y = 3;y>=0;y--)
				{
					for(var j = y-1;j>=0;j--)
					{
						if((arr[x][y] == arr[x][j] || arr[x][y] == 0) && arr[x][j]!=0)
							{
								if(arr[x][y]!=0 && arr[x][y-1]!=0 && arr[x][y-1]!=arr[x][y])
									break;
								arr[x][y]+=arr[x][j];
								arr[x][j] = 0;
								core+=arr[x][y];
								flag = 1;
								if(arr[x][y]==arr[x][j])
									break;
							}
					}
				}
			}
		createComponent();
		if (flag == 1){
			random();
		}
		flag = 0;
		createComponent();
	}
	function moveup(){
		var flag = 0;
		for(var y = 0;y<4;y++)
				for(var x = 0;x<4;x++)
					for(var j = x+1;j<4;j++)
					{
						if((arr[x][y] == arr[j][y] || arr[x][y] == 0) && arr[j][y]!=0)
							{
								if(arr[x][y]!=0 && arr[x+1][y]!=0 && arr[x+1][y]!=arr[x][y])
									break;
								arr[x][y]+=arr[j][y];
								arr[j][y] = 0;
								core+=arr[x][y];
								flag = 1;
								if(arr[x][y]==arr[j][y])
									break;
							}
					}
		createComponent();		
		if (flag == 1){
			random();
		}
		flag = 0;
		createComponent();
	}
	function movedown(){
		var flag = 0;
		for(var y = 0;y<4;y++)
				for(var x = 3;x>=0;x--)
					for(var j = x-1;j>=0;j--)
					{
						if((arr[x][y] == arr[j][y] || arr[x][y] == 0) && arr[j][y]!=0)
							{
								if(arr[x][y]!=0 && arr[x-1][y]!=0 && arr[x-1][y]!=arr[x][y])
									break;
								arr[x][y]+=arr[j][y];
								arr[j][y] = 0;
								core+=arr[x][y];
								flag = 1;
								if(arr[x][y]==arr[j][y])
									break;
							}
					}
		createComponent();
		if (flag == 1){
			random();
		}
		flag = 0;
		createComponent();
	}
	function newGame()
	{
		myGameArea.clear();
		init_array();
		random();
		createComponent();
	}
		</script>	
<button onclick="moveup()">UP</button>
<button onclick="movedown()">DOWN</button>
<button onclick="moveleft()">LEFT</button>
<button onclick="moveright()">RIGHT</button>
<button onclick="newGame()">NewGane</button>
	<body><canvas id = "mycanvas" width = "600" height = "600"></canvas></body>
	</head></html>